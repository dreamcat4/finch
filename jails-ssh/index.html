<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Finch - Jails Ssh</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Dreamcat4">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- google_prettify/sons-of-obsidian.css -->
    <!-- google_prettify/desert.css -->
    <!-- google_prettify/sunburst.css -->
    <!-- google_prettify/twitter-bootstrap.css -->
    <!-- google_prettify/default.css -->

<link href='/finch/assets/stylesheets/bootstrap.min-5534befd4bd1fd0a071242cecfe33975.css' type='text/css' rel='stylesheet' media='all'>
<link href='/finch/assets/stylesheets/poole-1a356f402a16003f83bb8aa793032345.css' type='text/css' rel='stylesheet' media='all'>
<link href='/finch/assets/stylesheets/style-cf56b256a9bd3b065ef200cb5c12edb6.css' type='text/css' rel='stylesheet' media='all'>
<link href='/finch/assets/stylesheets/google_prettify/default-twitter-merge-1166e58c1abf61b4fad842210480488b.css' type='text/css' rel='stylesheet' media='all'>
    <!-- Favicon and touch icons -->
    <link rel="shortcut icon" href="/finch/assets/media/favicon.ico">
    <!-- <link rel="apple-touch-icon" href="media/apple-touch-icon.png"> -->
    <!-- <link rel="apple-touch-icon" sizes="72x72" href="media/apple-touch-icon-72x72.png"> -->
    <!-- <link rel="apple-touch-icon" sizes="114x114" href="media/apple-touch-icon-114x114.png"> -->
 
  </head>

  <body class="theme-base-08">

    <div class="sidebar">
      <div class="container sidebar-sticky">
    
        <div class="sidebar-about">
    
              <h1 style="margin-bottom: -10px;">
                <a class="sidebar-nav-item" href="/finch">Finch</a>
              </h1>
    
          <!-- <p class="lead">FreeBSD... in a chroot!</p> -->
    
          <p class="lead">Freebsd... <strong><i>in a chroot!</i></strong></p>
          <!-- <p class="lead">Freebsd <strong><i>in a chroot!</i></strong></p> -->
    
          <!-- <div class="lead">Freebsd... <strong></div>
            <div class="lead"><i>&nbsp&nbsp&nbsp&nbsp&nbspin a chroot!</i></strong></div> -->
    
        </div>
    
        <ul class="sidebar-nav">
    
                <li class="sidebar-nav-item"><a href="/finch/install">Install</a></li>
                <li class="sidebar-nav-item"><a href="/finch/usage">Usage</a></li>
                <li class="sidebar-nav-item"><a href="/finch/manpage">Manpage</a></li>
                <li class="sidebar-nav-item"><a href="/finch/faq">FAQ</a></li>
                <li class="sidebar-nav-item"><a href="/finch/jails-how-to">Jails How To</a></li>
                <li class="sidebar-nav-item"><a href="/finch/jails-ip-addresses">Jails Ip Addresses</a></li>
                <li>
                  <a href="/finch/jails-ssh" class="sidebar-nav-item-active">Jails Ssh</a>
                </li>
                <li class="sidebar-nav-item"><a href="/finch/mounting-filesystems">Mounting Filesystems</a></li>
                <li class="sidebar-nav-item"><a href="/finch/qjail-reference">Qjail Reference</a></li>
                <li class="sidebar-nav-item"><a href="/finch/upgrading">Upgrading</a></li>
                <li class="sidebar-nav-item"><a href="/finch/bugs">Bugs</a></li>
    
              <!-- <li><a href="/finch/bugs">Bugs</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/bugs">Bugs</a></li> -->
              <!-- <li><a href="/finch/faq">FAQ</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/faq">FAQ</a></li> -->
              <!-- <li><a href="/finch/finch-8">Finch 8</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/finch-8">Finch 8</a></li> -->
              <!-- <li><a href="/finch">Index</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch">Index</a></li> -->
              <!-- <li><a href="/finch/install">Install</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/install">Install</a></li> -->
              <!-- <li><a href="/finch/jails-how-to">Jails How To</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/jails-how-to">Jails How To</a></li> -->
              <!-- <li><a href="/finch/jails-ip-addresses">Jails Ip Addresses</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/jails-ip-addresses">Jails Ip Addresses</a></li> -->
              <!-- <li class="active"><a href="/finch/jails-ssh" class="active">Jails Ssh</a></li> -->
              <!-- <li class="sidebar-nav-item-active"> -->
              <!-- <li>
                <a href="/finch/jails-ssh" class="sidebar-nav-item-active">Jails Ssh</a>
              </li> -->
              <!-- <li><a href="/finch/manpage">Manpage</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/manpage">Manpage</a></li> -->
              <!-- <li><a href="/finch/mounting-filesystems">Mounting Filesystems</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/mounting-filesystems">Mounting Filesystems</a></li> -->
              <!-- <li><a href="/finch/portsnap_override-8">Portsnap_override 8</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/portsnap_override-8">Portsnap_override 8</a></li> -->
              <!-- <li><a href="/finch/qjail-reference">Qjail Reference</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/qjail-reference">Qjail Reference</a></li> -->
              <!-- <li><a href="/finch/upgrading">Upgrading</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/upgrading">Upgrading</a></li> -->
              <!-- <li><a href="/finch/usage">Usage</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/usage">Usage</a></li> -->
    
              <!-- <a href="https://github.com/dreamcat4/finch/issues">Bugtracker</a> -->
    
                <!-- <li class="sidebar-nav-item{% if page.url == node.url %} active{% endif %}"> -->
    
    
    
                  <!-- <a href=""></a> -->
    
                  <!-- 
                    
                      <li><a href="/finch/bugs">Bugs</a></li>
                    
                  
                    
                      <li><a href="/finch/faq">FAQ</a></li>
                    
                  
                    
                      <li><a href="/finch/finch-8">Finch 8</a></li>
                    
                  
                    
                      <li><a href="/finch">Index</a></li>
                    
                  
                    
                      <li><a href="/finch/install">Install</a></li>
                    
                  
                    
                      <li><a href="/finch/jails-how-to">Jails How To</a></li>
                    
                  
                    
                      <li><a href="/finch/jails-ip-addresses">Jails Ip Addresses</a></li>
                    
                  
                      <li class="active"><a href="/finch/jails-ssh" class="active">Jails Ssh</a></li>
                    
                    
                  
                    
                      <li><a href="/finch/manpage">Manpage</a></li>
                    
                  
                    
                      <li><a href="/finch/mounting-filesystems">Mounting Filesystems</a></li>
                    
                  
                    
                      <li><a href="/finch/portsnap_override-8">Portsnap_override 8</a></li>
                    
                  
                    
                      <li><a href="/finch/qjail-reference">Qjail Reference</a></li>
                    
                  
                    
                      <li><a href="/finch/upgrading">Upgrading</a></li>
                    
                  
                    
                      <li><a href="/finch/usage">Usage</a></li>
                    
                   -->
    
    
                </li>
              <!-- {% endif %}
            {% endif %}
          {% endfor %} -->
    
          <!-- <li class="sidebar-nav-item"><a href="dreamcat4/finch/archive/v.zip">Download</a></li> -->
          <!-- <li class="sidebar-nav-item"><a href="https://github.com/dreamcat4/finch">GitHub Project</a></li> -->
          <!-- <li class="sidebar-nav-item">Currently v</li> -->
    
          <!-- <li class="sidebar-nav-item"><a href="https://github.com/dreamcat4/finch">GitHub Project</a></li> -->
          
          <p></p>
          <!-- <p></p> -->
        </ul>
        <!-- <p> -->
        <p>
          <!-- <class="crumbline" style="color: #515151; font-size: 16px; font-style: italic; font-weight: 400;" href="https://github.com/dreamcat4/finch">GitHub Project</a> -->
          <!-- <a class="sidebar-nav" class="crumbline" style="color: #515151; font-size: 16px; font-style: italic; font-weight: 400;" href="https://github.com/dreamcat4/finch">GitHub Project</a> -->
    
          <!-- <a class="sidebar-nav" class="crumbline" style="color: #515151; font-size: 16px; font-style: italic; font-weight: 400;" href="#toc_0">Back to Top</a> -->
    
          <a class="sidebar-nav" class="crumbline" style="color: #515151; font-size: 16px; font-style: italic; font-weight: 400;" href="/finch/jails-ssh">Back to Top</a>
    
          <!-- © 2014. All rights reserved. -->
        </p>
    
        <!-- <p>&copy; {--{ site.time | date: '%Y' }--}. All rights reserved.</p> -->
      </div>
    </div>
    

    <div class="navbar">
      <div class="navbar-inner">
        <!-- <div class="container-narrow"> -->
          <!-- <a class="brand" href="/finch/">Finch</a> -->
    
          <!-- <p class="navbar-left"> -->
          <div class="navbar-left">
    
            <!-- Project hosted on Github <a href="https://github.com/dreamcat4/finch">dreamcat4/finch</a> -->
    
            <ul class="nav">
                  <li><a href="/finch">Home</a></li>
    
                
                  <li><a href="/finch/manpage">Manpage</a></li>
                
                
                  <li><a href="/finch/install">Install</a></li>
                
                
                  <li><a href="/finch/faq">FAQ</a></li>
                
    
            </ul>
    
          <!-- </p> -->
          </div>
    
    
          <!-- <p class="footer-center">
          </p> -->
    
          <!-- <p class="navbar-right"> -->
          <div class="navbar-right">
    
            <!-- &copy; Dreamcat4 2014,  -->
            <!-- FreeBSD Licensing terms. -->
    
    
            <ul class="nav">
    
                
                  <li><a href="/finch/jails-how-to">Jails How To</a></li>
                
                
                  <li><a href="/finch/upgrading">Upgrading</a></li>
                
                
                  <li><a href="/finch/bugs">Bugs</a></li>
                
    
              <!--  -->
    
              <!-- 
                
                  <li><a href="/finch/bugs">Bugs</a></li>
                
              
                
                  <li><a href="/finch/faq">FAQ</a></li>
                
              
                
                  <li><a href="/finch/finch-8">Finch 8</a></li>
                
              
                
                  <li><a href="/finch">Index</a></li>
                
              
                
                  <li><a href="/finch/install">Install</a></li>
                
              
                
                  <li><a href="/finch/jails-how-to">Jails How To</a></li>
                
              
                
                  <li><a href="/finch/jails-ip-addresses">Jails Ip Addresses</a></li>
                
              
                  <li class="active"><a href="/finch/jails-ssh" class="active">Jails Ssh</a></li>
                
                
              
                
                  <li><a href="/finch/manpage">Manpage</a></li>
                
              
                
                  <li><a href="/finch/mounting-filesystems">Mounting Filesystems</a></li>
                
              
                
                  <li><a href="/finch/portsnap_override-8">Portsnap_override 8</a></li>
                
              
                
                  <li><a href="/finch/qjail-reference">Qjail Reference</a></li>
                
              
                
                  <li><a href="/finch/upgrading">Upgrading</a></li>
                
              
                
                  <li><a href="/finch/usage">Usage</a></li>
                
               -->
            </ul>
    
          <!-- </p> -->
          </div>
    
        <!-- </div> -->
      </div>
    </div>
    

    <div class="logo"></div>

    <div class="container-narrow">

      <div class="content">
        <h1 id="toc_0">Jails - Ssh</h1>

<p><ul>
<li>
<a href="#toc_0">Jails - Ssh</a>
<ul>
<li>
<a href="#toc_1">Terminal access via FreeBSD host</a>
</li>
<li>
<a href="#toc_2">3 ways to create a jail with ssh access</a>
</li>
<li>
<a href="#toc_3">Create a jail with ssh enabled</a>
<ul>
<li>
<a href="#toc_4">Part A - Create the jail</a>
</li>
<li>
<a href="#toc_5">Part B - Create an account for ssh&#39;ing into your jail</a>
</li>
</ul>
</li>
<li>
<a href="#toc_6">Create a jail with ssh enabled for root</a>
</li>
<li>
<a href="#toc_7">Turn on ssh in an existing jail</a>
</li>
</ul>
</li>
</ul>
</p>

<h2 id="toc_1">Terminal access via FreeBSD host</h2>

<p>If you create a jail without specifying ssh, it will not be enabled on that jail. However if we can ssh into the FreeBSD host machine then we may use that same route to access any of our jails.</p>

<p>The command <code>qjail console $jailname</code> will launch a root login shell and enter you into the chosen jail.</p>

<pre><code>ssh &quot;$freebsd_host&quot;
sudo qjail console &quot;$jailname&quot;
</code></pre>

<p>Or as one single command:</p>

<pre><code>ssh &quot;$freebsd_host&quot; sudo finch chroot qjail console &quot;$jailname&quot;
</code></pre>

<p>This can be made into a very simple shell function or a batch file on Windows. For example:</p>

<pre><code>qjail-remote-console ()
{
  if [ &quot;$#&quot; -gt &quot;0&quot; ]; then
    local freebsd_host=&quot;192.168.1.XXX&quot;     # the freebsd host system

    ssh &quot;$freebsd_host&quot; sudo finch chroot qjail console &quot;$@&quot;

  else
    echo &quot;usage: qjail-remote-console &lt;jailname&gt;&quot;
  fi
}
</code></pre>

<p><strong>Note:</strong> The <code>qjail console</code> command only provides a login for tty / terminal access. It does not enable ssh inside the jail. Almost all other ssh-based services are designed to connect to a real ssh daemon and won&#39;t work with this method.</p>

<h2 id="toc_2">3 ways to create a jail with ssh access</h2>

<p>It&#39;s best to decide upon ssh access <strong>before</strong> creating your jails. There are 2-3 ssh templates (known as <code>flavors</code>) to choose from.</p>

<ul>
<li><p>Firstly, the qjail flavor <code>ssh-default</code> is provided by <code>qjail</code>. And is documented in the qjail manpage (enabled with the <code>-c</code> switch on <code>qjail create</code>, or <code>-h</code> switch on <code>qjail config</code>). We do not encourage it&#39;s use however because you are forced into using a specific username.</p></li>
<li><p>Using a <code>finch</code> template - RECOMMENDED. Finch installs for you 2 templates (known as <code>flavors</code>) which will provide ssh access in a more flexible way than qjail&#39;s built-in method. They are are documented below further down on this page. Choose either the &quot;finch-ssh&quot; or &quot;finch-ssh-root&quot; flavor when creating your jail. The only difference is that &quot;finch-ssh&quot; will forbid root account ssh logins. Wheras &quot;finsh-ssh-root&quot; will permit ssh logins for all user accounts, including the <code>root</code> user. It&#39;s a personal security choice. You only need to follow ONE of the 2 documented procedures (not both of them).</p></li>
<li><p>Finally the last method is to manually turn on ssh for an existing jail. Because you might have already created your jail without the necessary ssh flavor, or have deferred the decision to switch on ssh until later on.</p></li>
</ul>

<p>After enabling ssh access, you can login over ssh with a username and password. This will in turn allow you to setup passwordless ssh access. So as a final step (after choosing one of the 3 available solutions on <em>this</em> page), then why not head on over to <a href="http://www.commandlinefu.com/commands/view/188/copy-your-ssh-public-key-to-a-server-from-a-machine-that-doesnt-have-ssh-copy-id">commandlinefu.com</a> where you can learn how to scp over your ssh keys (<code>~/.ssh/id_rsa.pub</code>) and edit your <code>~/.ssh/authorized_keys</code> file.</p>

<h2 id="toc_3">Create a jail with ssh enabled</h2>

<p>This flavor does not permit ssh logins for the root account.</p>

<h3 id="toc_4">Part A - Create the jail</h3>

<pre><code># Enter the finch chroot environment, as root
sudo finch chroot

# Read the page &quot;jail-ip-addresses&quot; before choosing a jail IP address
jail_ip=&quot;192.168.1.202&quot;

# Give an appropriate server name to your jail
jailname=&quot;ssh&quot;

# Create a jail with the &quot;finch-ssh&quot; flavor
qjail create -f finch-ssh -4 &quot;$jail_ip&quot; &quot;$jailname&quot;

# Start the jail
qjail start &quot;$jailname&quot;
</code></pre>

<h3 id="toc_5">Part B - Create an account for ssh&#39;ing into your jail</h3>

<p>In the example below we assume that you want a wheel account to use for administering your jail. However superuser privileges are not a requirement for ssh&#39;ing. In which case just omit the <code>&quot;-G wheel&quot;</code> part to create a regular account.</p>

<pre><code># 1. Login locally (as root)
qjail console &quot;$jailname&quot;

# 2. Create an account
username=&quot;admin&quot; # put here your own username
pw user add &quot;$username&quot; -c &quot;$username&#39;s account&quot; -m -G wheel

# 3. Set a password. Otherwise we are not permitted to login over ssh
passwd &quot;$username&quot;
exit

# Test the connection - ssh into the jail
username=&quot;admin&quot; # put again your chosen username
ssh &quot;${username}@${jail_ip}&quot;
</code></pre>

<h2 id="toc_6">Create a jail with ssh enabled for root</h2>

<p>This flavor does permit ssh logins for the <code>root</code> account. And regular users too.</p>

<pre><code># Enter the finch chroot environment, as root
sudo finch chroot

# Read the page &quot;jail-ip-addresses&quot; before choosing a jail IP address
jail_ip=&quot;192.168.1.203&quot;

# Give an appropriate server name to your jail
jailname=&quot;root-ssh&quot;

# Create a jail with the &quot;finch-ssh-root&quot; flavor
qjail create -f finch-ssh-root -4 &quot;$jail_ip&quot; &quot;$jailname&quot;

# Start the jail
qjail start &quot;$jailname&quot;

# Set a password. Otherwise we are not permitted to login over ssh
qjail console &quot;$jailname&quot;
passwd &quot;root&quot;
exit

# Test the connection - ssh into the jail
username=&quot;root&quot; # put again your chosen username
ssh &quot;${username}@${jail_ip}&quot;
</code></pre>

<h2 id="toc_7">Turn on ssh in an existing jail</h2>

<p>For an existing jail, we can manually copy over the same ssh configuration files, as would have been used in creating a new jail.</p>

<pre><code># Set to the name of your existing jail
jailname=&quot;nginx&quot;

# 1. Either forbid the root account to have ssh access
cp -Rf &quot;/usr/jails/flavors/finch-ssh/etc/ssh&quot; &quot;/usr/jails/${jailname}/etc/&quot;

# 2. Or permit the root account to have ssh access
cp -Rf &quot;/usr/jails/flavors/finch-ssh-root/etc/ssh&quot; &quot;/usr/jails/${jailname}/etc/&quot;

# Edit the jail&#39;s rc.conf file to enable the ssh daemon
sysrc -f &quot;/usr/jails/${jailname}/etc/rc.conf&quot; &quot;sshd_enable=YES&quot;

# Make sure you have created your chosen ssh login accounts.
# You must also set a password as per the previous the example(s) above ^^

# Restart the jail - to start the ssh daemon
qjail restart &quot;$jailname&quot;

# Test the connection - ssh into the jail
username=&quot;root&quot; # put again your chosen username
ssh &quot;${username}@${jail_ip}&quot;
</code></pre>

      </div>

      <!-- last linebreak for manpage -->
      <p style="line-height: 0px;">&nbsp;</p> 

      <div class="footer">
        <hr class="footer-hr">
      
        <!-- order is backwards b/c footer-left style isnt loaded -->
        <div class="footer-left" style="float: left; position: absolute;">
          <!-- Project hosted on Github <a href="https://github.com/dreamcat4/finch">dreamcat4/finch</a> -->
          Project hosted on Github @ <a href="https://github.com/dreamcat4/finch">dreamcat4/finch</a>.
        </div>
        <div class="footer-right" style="float: right; position: relative;">
          &copy; Dreamcat4 2014, 
           FreeBSD License.
        </div>
      
        <div style="clear: both;"></div>​
      </div>
      

    </div> <!-- /container -->

    <!-- Google Prettify -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
<script>
  var pres = document.getElementsByTagName("pre");
  for (var i=0; i < pres.length; ++i) {
    pres[i].className = "prettyprint ";
  }
  prettyPrint();
</script>
<!-- end Google Prettify -->
    
    
  </body>
</html>
