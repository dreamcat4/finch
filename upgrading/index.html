<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Finch - Upgrading</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Dreamcat4">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- google_prettify/sons-of-obsidian.css -->
    <!-- google_prettify/desert.css -->
    <!-- google_prettify/sunburst.css -->
    <!-- google_prettify/twitter-bootstrap.css -->
    <!-- google_prettify/default.css -->

<link href='/finch/assets/stylesheets/bootstrap.min-5534befd4bd1fd0a071242cecfe33975.css' type='text/css' rel='stylesheet' media='all'>
<link href='/finch/assets/stylesheets/poole-1a356f402a16003f83bb8aa793032345.css' type='text/css' rel='stylesheet' media='all'>
<link href='/finch/assets/stylesheets/style-cf56b256a9bd3b065ef200cb5c12edb6.css' type='text/css' rel='stylesheet' media='all'>
<link href='/finch/assets/stylesheets/google_prettify/default-twitter-merge-1166e58c1abf61b4fad842210480488b.css' type='text/css' rel='stylesheet' media='all'>
    <!-- Favicon and touch icons -->
    <link rel="shortcut icon" href="/finch/assets/media/favicon.ico">
    <!-- <link rel="apple-touch-icon" href="media/apple-touch-icon.png"> -->
    <!-- <link rel="apple-touch-icon" sizes="72x72" href="media/apple-touch-icon-72x72.png"> -->
    <!-- <link rel="apple-touch-icon" sizes="114x114" href="media/apple-touch-icon-114x114.png"> -->
 
  </head>

  <body class="theme-base-08">

    <div class="sidebar">
      <div class="container sidebar-sticky">
    
        <div class="sidebar-about">
    
              <h1 style="margin-bottom: -10px;">
                <a class="sidebar-nav-item" href="/finch">Finch</a>
              </h1>
    
          <!-- <p class="lead">FreeBSD... in a chroot!</p> -->
    
          <p class="lead">Freebsd... <strong><i>in a chroot!</i></strong></p>
          <!-- <p class="lead">Freebsd <strong><i>in a chroot!</i></strong></p> -->
    
          <!-- <div class="lead">Freebsd... <strong></div>
            <div class="lead"><i>&nbsp&nbsp&nbsp&nbsp&nbspin a chroot!</i></strong></div> -->
    
        </div>
    
        <ul class="sidebar-nav">
    
                <li class="sidebar-nav-item"><a href="/finch/install">Install</a></li>
                <li class="sidebar-nav-item"><a href="/finch/usage">Usage</a></li>
                <li class="sidebar-nav-item"><a href="/finch/manpage">Manpage</a></li>
                <li class="sidebar-nav-item"><a href="/finch/faq">FAQ</a></li>
                <li class="sidebar-nav-item"><a href="/finch/jails-how-to">Jails How To</a></li>
                <li class="sidebar-nav-item"><a href="/finch/jails-ip-addresses">Jails Ip Addresses</a></li>
                <li class="sidebar-nav-item"><a href="/finch/jails-ssh">Jails Ssh</a></li>
                <li class="sidebar-nav-item"><a href="/finch/mounting-filesystems">Mounting Filesystems</a></li>
                <li class="sidebar-nav-item"><a href="/finch/qjail-reference">Qjail Reference</a></li>
                <li>
                  <a href="/finch/upgrading" class="sidebar-nav-item-active">Upgrading</a>
                </li>
                <li class="sidebar-nav-item"><a href="/finch/support">Support</a></li>
    
              <!-- <li><a href="/finch/faq">FAQ</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/faq">FAQ</a></li> -->
              <!-- <li><a href="/finch/finch-8">Finch 8</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/finch-8">Finch 8</a></li> -->
              <!-- <li><a href="/finch">Index</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch">Index</a></li> -->
              <!-- <li><a href="/finch/install">Install</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/install">Install</a></li> -->
              <!-- <li><a href="/finch/jails-how-to">Jails How To</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/jails-how-to">Jails How To</a></li> -->
              <!-- <li><a href="/finch/jails-ip-addresses">Jails Ip Addresses</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/jails-ip-addresses">Jails Ip Addresses</a></li> -->
              <!-- <li><a href="/finch/jails-ssh">Jails Ssh</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/jails-ssh">Jails Ssh</a></li> -->
              <!-- <li><a href="/finch/manpage">Manpage</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/manpage">Manpage</a></li> -->
              <!-- <li><a href="/finch/mounting-filesystems">Mounting Filesystems</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/mounting-filesystems">Mounting Filesystems</a></li> -->
              <!-- <li><a href="/finch/portsnap_override-8">Portsnap_override 8</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/portsnap_override-8">Portsnap_override 8</a></li> -->
              <!-- <li><a href="/finch/qjail-reference">Qjail Reference</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/qjail-reference">Qjail Reference</a></li> -->
              <!-- <li><a href="/finch/support">Support</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/support">Support</a></li> -->
              <!-- <li class="active"><a href="/finch/upgrading" class="active">Upgrading</a></li> -->
              <!-- <li class="sidebar-nav-item-active"> -->
              <!-- <li>
                <a href="/finch/upgrading" class="sidebar-nav-item-active">Upgrading</a>
              </li> -->
              <!-- <li><a href="/finch/usage">Usage</a></li> -->
              <!-- <li class="sidebar-nav-item"><a href="/finch/usage">Usage</a></li> -->
    
              <!-- <a href="https://github.com/dreamcat4/finch/issues">Bugtracker</a> -->
    
                <!-- <li class="sidebar-nav-item{% if page.url == node.url %} active{% endif %}"> -->
    
    
    
                  <!-- <a href=""></a> -->
    
                  <!-- 
                    
                      <li><a href="/finch/faq">FAQ</a></li>
                    
                  
                    
                      <li><a href="/finch/finch-8">Finch 8</a></li>
                    
                  
                    
                      <li><a href="/finch">Index</a></li>
                    
                  
                    
                      <li><a href="/finch/install">Install</a></li>
                    
                  
                    
                      <li><a href="/finch/jails-how-to">Jails How To</a></li>
                    
                  
                    
                      <li><a href="/finch/jails-ip-addresses">Jails Ip Addresses</a></li>
                    
                  
                    
                      <li><a href="/finch/jails-ssh">Jails Ssh</a></li>
                    
                  
                    
                      <li><a href="/finch/manpage">Manpage</a></li>
                    
                  
                    
                      <li><a href="/finch/mounting-filesystems">Mounting Filesystems</a></li>
                    
                  
                    
                      <li><a href="/finch/portsnap_override-8">Portsnap_override 8</a></li>
                    
                  
                    
                      <li><a href="/finch/qjail-reference">Qjail Reference</a></li>
                    
                  
                    
                      <li><a href="/finch/support">Support</a></li>
                    
                  
                      <li class="active"><a href="/finch/upgrading" class="active">Upgrading</a></li>
                    
                    
                  
                    
                      <li><a href="/finch/usage">Usage</a></li>
                    
                   -->
    
    
                </li>
              <!-- {% endif %}
            {% endif %}
          {% endfor %} -->
    
          <!-- <li class="sidebar-nav-item"><a href="dreamcat4/finch/archive/v.zip">Download</a></li> -->
          <!-- <li class="sidebar-nav-item"><a href="https://github.com/dreamcat4/finch">GitHub Project</a></li> -->
          <!-- <li class="sidebar-nav-item">Currently v</li> -->
    
          <!-- <li class="sidebar-nav-item"><a href="https://github.com/dreamcat4/finch">GitHub Project</a></li> -->
          
          <p></p>
          <!-- <p></p> -->
        </ul>
        <!-- <p> -->
        <p>
          <!-- <class="crumbline" style="color: #515151; font-size: 16px; font-style: italic; font-weight: 400;" href="https://github.com/dreamcat4/finch">GitHub Project</a> -->
          <!-- <a class="sidebar-nav" class="crumbline" style="color: #515151; font-size: 16px; font-style: italic; font-weight: 400;" href="https://github.com/dreamcat4/finch">GitHub Project</a> -->
    
          <!-- <a class="sidebar-nav" class="crumbline" style="color: #515151; font-size: 16px; font-style: italic; font-weight: 400;" href="#toc_0">Back to Top</a> -->
    
          <a class="sidebar-nav" class="crumbline" style="color: #515151; font-size: 16px; font-style: italic; font-weight: 400;" href="/finch/upgrading">Back to Top</a>
    
          <!-- © 2014. All rights reserved. -->
        </p>
    
        <!-- <p>&copy; {--{ site.time | date: '%Y' }--}. All rights reserved.</p> -->
      </div>
    </div>
    

    <div class="navbar">
      <div class="navbar-inner">
        <!-- <div class="container-narrow"> -->
          <!-- <a class="brand" href="/finch/">Finch</a> -->
    
          <!-- <p class="navbar-left"> -->
          <div class="navbar-left">
    
            <!-- Project hosted on Github <a href="https://github.com/dreamcat4/finch">dreamcat4/finch</a> -->
    
            <ul class="nav">
                  <li><a href="/finch">Home</a></li>
    
                
                  <li><a href="/finch/manpage">Manpage</a></li>
                
                
                  <li><a href="/finch/install">Install</a></li>
                
                
                  <li><a href="/finch/faq">FAQ</a></li>
                
    
            </ul>
    
          <!-- </p> -->
          </div>
    
    
          <!-- <p class="footer-center">
          </p> -->
    
          <!-- <p class="navbar-right"> -->
          <div class="navbar-right">
    
            <!-- &copy; Dreamcat4 2014,  -->
            <!-- FreeBSD Licensing terms. -->
    
    
            <ul class="nav">
    
                
                  <li><a href="/finch/jails-how-to">Jails How To</a></li>
                
                  <li class="active"><a href="/finch/upgrading" class="active">Upgrading</a></li>
                
                
                
                  <li><a href="/finch/support">Support</a></li>
                
    
              <!--  -->
    
              <!-- 
                
                  <li><a href="/finch/faq">FAQ</a></li>
                
              
                
                  <li><a href="/finch/finch-8">Finch 8</a></li>
                
              
                
                  <li><a href="/finch">Index</a></li>
                
              
                
                  <li><a href="/finch/install">Install</a></li>
                
              
                
                  <li><a href="/finch/jails-how-to">Jails How To</a></li>
                
              
                
                  <li><a href="/finch/jails-ip-addresses">Jails Ip Addresses</a></li>
                
              
                
                  <li><a href="/finch/jails-ssh">Jails Ssh</a></li>
                
              
                
                  <li><a href="/finch/manpage">Manpage</a></li>
                
              
                
                  <li><a href="/finch/mounting-filesystems">Mounting Filesystems</a></li>
                
              
                
                  <li><a href="/finch/portsnap_override-8">Portsnap_override 8</a></li>
                
              
                
                  <li><a href="/finch/qjail-reference">Qjail Reference</a></li>
                
              
                
                  <li><a href="/finch/support">Support</a></li>
                
              
                  <li class="active"><a href="/finch/upgrading" class="active">Upgrading</a></li>
                
                
              
                
                  <li><a href="/finch/usage">Usage</a></li>
                
               -->
            </ul>
    
          <!-- </p> -->
          </div>
    
        <!-- </div> -->
      </div>
    </div>
    

    <div class="logo"></div>

    <div class="container-narrow">

      <div class="content">
        <h1 id="toc_0">Upgrading Finch FreeBSD</h1>

<p><ul>
<li>
<a href="#toc_0">Upgrading Finch FreeBSD</a>
<ul>
<li>
<a href="#toc_1">Introduction</a>
<ul>
<li>
<a href="#toc_2">Warning</a>
</li>
<li>
<a href="#toc_3">Check your EDITOR and PAGER</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#toc_4">Minor updates to FreeBSD</a>
</li>
<li>
<a href="#toc_5">Major upgrade of FreeBSD</a>
<ul>
<li>
<a href="#toc_6">AFTER the host system</a>
</li>
<li>
<a href="#toc_7">BEFORE the host system</a>
</li>
</ul>
</li>
</ul>
</p>

<h2 id="toc_1">Introduction</h2>

<p>Let&#39;s say we installed Finch onto a FreeBSD 9.2-RELEASE host system. But now we would like to upgrade to FreeBSD 10.0-RELEASE. Then we must also upgrade Finch to match. Otherwise the finch chroot environment may not function properly until both systems are put back on the same page. Same goes for any jails you may have installed inside Finch.</p>

<p>We can upgrade Finch FreeBSD in much the same way as any official FreeBSD distribution with <a href="http://www.freebsd.org/cgi/man.cgi?query=freebsd-update"><code>freebsd-update</code></a>. However for a Finch installation we must add some extra steps at certain points during the process. We can also upgrade any jails, if they are present.</p>

<h3 id="toc_2">Warning</h3>

<p>We cannot know beforehand or be held responsible for any failures / breakages / data loss caused by freebsd-update. You have been warned. That having been said, FreeBSD update is not commonly known to fail or leave your system broken. Breakages tend to be few, minor in nature, and accompanied by a documented procedure with which to apply a relevant fix or workaround.</p>

<p>If you have sufficient time and disk space then consider making a full backup beforehand. Just in case anything else goes wrong. The power might be interrupted, an unforeseen error may occur, etc.</p>

<h3 id="toc_3">Check your EDITOR and PAGER</h3>

<p>In all likelihood you may be asked to merge the occasional configuration file. In which case freebsd-update will open the program set in your <code>$EDITOR</code> environment variable. Not everyone can use &quot;vi&quot;. So please be adequately prepared with an appropriate text editor <em>beforehand</em> which you feel comfortable with. Same goes for the pager. You might not need to change anything. Finch should have already set them up for you as <code>nano</code>, and <code>less</code>.</p>

<pre><code># What&#39;s your current default text editor ?
echo &quot;$EDITOR&quot;

# Possible editors: `vi`, `ee`, `nano`.
export EDITOR=&quot;nano&quot;

# Check that it is on your &quot;$PATH&quot;.
command -v &quot;$EDITOR&quot; # or `which &quot;$EDITOR&quot;` for tcsh shell

# freebsd-update also uses your &quot;$PAGER&quot;
export PAGER=&quot;less&quot;
</code></pre>

<h1 id="toc_4">Minor updates to FreeBSD</h1>

<p>How to update the <strong>patch level</strong>. For example <code>9.2.1-p9</code> --&gt; <code>9.2.1-p21</code>. Minor updates are for bugs, security fixes etc. Do the same as a regular FreeBSD update. Nothing extra special needs to be done for Finch.</p>

<pre><code># Enter the finch chroot environment, as root
sudo finch chroot

# Updating can be done interactively at any time
freebsd-update fetch install

# Go ahead and install the new patch level
freebsd-update install

# (optional) Update binaries inside your jails
qjail update -b

# To revert the last set of applied changes
freebsd-update rollback
</code></pre>

<p>You may also check for updates in a cron job, and recieve an email report when new updates become available. However installation of updates still needs to be performed manually. Consult the <a href="http://www.freebsd.org/cgi/man.cgi?query=freebsd-update"><code>freebsd-update</code></a> manpage for more details.</p>

<h1 id="toc_5">Major upgrade of FreeBSD</h1>

<p>How to update to a higher <strong>point release</strong>, or a <strong>major version</strong>. For example <code>9.1-RELEASE</code> --&gt; <code>9.2-RELEASE</code> or <code>9.2-RELEASE</code> --&gt; <code>10.0-RELEASE</code>.</p>

<p><strong><em>Note:</em></strong> You may upgrade Finch <em>before or after</em> upgrading the host system. The process can be done <em>either way round</em>. However the procedure is a little bit different in each case. </p>

<h2 id="toc_6">AFTER the host system</h2>

<p>Use this procedure if you need to upgrade Finch AFTER upgrading the host system.</p>

<pre><code># We assume you have already followed the official proceedure
# for upgrading FreeBSD on your host system. For example:
#
# On FreeNAS / NAS4Free:
#   * Backup config. Upgrade FreeNAS / NAS4Free. Restore config.
#
# On FreeBSD GENERIC: 
#   * Ran $ freebsd-update as per official FreeBSD guidelines.
#

# Enter the finch chroot environment, as root
sudo finch chroot

# Check the current version of finch
cat &quot;/var/db/finch/installed&quot;
FreeBSD-amd64-9.2-RELEASE

# Put here the newer target version of FreeBSD you want to upgrade to
new_release=&quot;10.0-RELEASE&quot;

# We must spoof the &quot;uname&quot; command to match the contents of &quot;/var/db/finch/installed&quot;
# to avoid the error &quot;freebsd-update: Cannot upgrade from X.Y-RELEASE to itself&quot;.
uname_override on

# Fetch the upgrade. You will be prompted to confirm the action.
# Please note that this step usually takes a while. Maybe an hour.
freebsd-update -r &quot;$new_release&quot; upgrade

# Return the &quot;uname&quot; program back to normal.
uname_override off

# Apply the changes. Upgrade Finch.
# This is an an interactive task. You may be asked to merge certain files.
freebsd-update install

# &lt;-- ... snip ... --&gt;

# If all goes well, you should see this message at the very end:
Kernel updates have been installed.  Please reboot and run
&quot;/usr/sbin/freebsd-update install&quot; again to finish installing updates.

# We are asked to reboot into the new FreeBSD kernel. Then rerun the same command.
# Hoever we are already on the new Kernel. so just run it again (no reboot required).
freebsd-update install

# You may have got a few errors like: &quot;ln: ///.cshrc: No such file or directory&quot;
# Sorry the cause isn&#39;t known.
# We recommend to ignore such errors if they are about non-essential files.

# Tell Finch that we have updated FreeBSD. So Finch doesn&#39;t keep pestering us about it.
echo &quot;FreeBSD-`uname -m`-`uname -r | cut -d- -f1-2`&quot; &gt; &quot;/var/db/finch/installed&quot;

# Optional

# For MAJOR version updates only (FreeBSD 9 -&gt; 10). SKIP for MINOR versions (9.1 --&gt; 9.2).
# Brute-force rebuild of all installed ports. BEWARE: Can often lead to breakages or build errors.
portmaster -f

# For jails, update the jails&#39; binaries.
qjail update -b

# Remove any original FreeBSD distfiles (if present) - they are no longer valid.
rm -rf /var/distfiles/finch

# All done.
</code></pre>

<h2 id="toc_7">BEFORE the host system</h2>

<p>Use this procedure if you need to upgrade Finch BEFORE upgrading the host system.</p>

<pre><code># Enter the finch chroot environment, as root
sudo finch chroot

# Check the current version of finch
cat &quot;/var/db/finch/installed&quot;
FreeBSD-amd64-9.1-RELEASE

# Put here the newer target version of FreeBSD you want to upgrade to
new_release=&quot;10.0-RELEASE&quot;

# Fetch the upgrade. You will be prompted to confirm the action.
# Please note that this step usually takes a while. Maybe an hour.
freebsd-update -r &quot;$new_release&quot; upgrade

# Apply the changes. Upgrade Finch.
# This is an an interactive task. You may be asked to merge certain files.
freebsd-update install

# &lt;-- ... snip ... --&gt;

# If all goes well, you should see this message at the very end:
Kernel updates have been installed.  Please reboot and run
&quot;/usr/sbin/freebsd-update install&quot; again to finish installing updates.

# At this point, we assume you will now follow the official proceedure
# for upgrading FreeBSD on your host system. For example:
#
# On FreeNAS / NAS4Free:
#   * Backup config. Upgrade FreeNAS / NAS4Free. Restore config.
#
# On FreeBSD GENERIC: 
#   * Run $ freebsd-update as per official FreeBSD guidelines.
#

# Host system updates completed successfully ?
# At this point, we assume you have booted into the new kernel.

# Re-enter our chroot environment
sudo finch chroot

# Finish applying Finch&#39;s FreeBSD updates.
freebsd-update install

# You may have got a few errors like: &quot;ln: ///.cshrc: No such file or directory&quot;
# Sorry the cause isn&#39;t known.
# We recommend to ignore such errors if they are about non-essential files.

# Update our records, and so that finch does not keep pestering us to update FreeBSD.
echo &quot;FreeBSD-`uname -m`-`uname -r | cut -d- -f1-2`&quot; &gt; &quot;/var/db/finch/installed&quot;

# Optional

# For MAJOR version updates only (FreeBSD 9 -&gt; 10). SKIP for MINOR versions (9.1 --&gt; 9.2).
# Brute-force rebuild of all installed ports. BEWARE: Can often lead to breakages or build errors.
portmaster -f

# For jails, update the jails&#39; binaries.
qjail update -b

# Remove any original FreeBSD distfiles (if present) - they are no longer valid.
rm -rf /var/distfiles/finch

# All done.
</code></pre>

      </div>

      <!-- last linebreak for manpage -->
      <p style="line-height: 0px;">&nbsp;</p> 

      <div class="footer">
        <hr class="footer-hr">
      
        <!-- order is backwards b/c footer-left style isnt loaded -->
        <div class="footer-left" style="float: left; position: absolute;">
          <!-- Project hosted on Github <a href="https://github.com/dreamcat4/finch">dreamcat4/finch</a> -->
          Project hosted on Github @ <a href="https://github.com/dreamcat4/finch">dreamcat4/finch</a>.
        </div>
        <div class="footer-right" style="float: right; position: relative;">
          &copy; Dreamcat4 2014, 
           FreeBSD License.
        </div>
      
        <div style="clear: both;"></div>​
      </div>
      

    </div> <!-- /container -->

    <!-- Google Prettify -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
<script>
  var pres = document.getElementsByTagName("pre");
  for (var i=0; i < pres.length; ++i) {
    pres[i].className = "prettyprint ";
  }
  prettyPrint();
</script>
<!-- end Google Prettify -->
    
    
  </body>
</html>
